(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{248:function(e,t,n){"use strict";n.r(t);var a=n(0),r=Object(a.a)({},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"content"},[n("p",[e._v("ENGINEERING   SÉBASTIEN DELEUZE   JUNE 08, 2015\nFor security reasons, browsers prohibit AJAX calls to resources residing outside the current origin. For example, as you’re checking your bank account in one tab, you could have the evil.com website in another tab. The scripts from evil.com shouldn’t be able to make AJAX requests to your bank API (withdrawing money from your account!) using your credentials.")]),e._v(" "),n("p",[e._v("Cross-origin resource sharing (CORS) is a W3C specification implemented by most browsers that allows you to specify in a flexible way what kind of cross domain requests are authorized, instead of using some less secured and less powerful hacks like IFrame or JSONP.")]),e._v(" "),n("p",[e._v("Spring Framework 4.2 GA provides first class support for CORS out-of-the-box, giving you an easier and more powerful way to configure it than typical filter based solutions.")]),e._v(" "),n("p",[e._v("Spring MVC provides high-level configuration facilities, described bellow.")]),e._v(" "),n("p",[e._v("Controller method CORS configuration\nYou can add to your @RequestMapping annotated handler method a @CrossOrigin annotation in order to enable CORS on it (by default @CrossOrigin allows all origins and the HTTP methods specified in the @RequestMapping annotation):")]),e._v(" "),e._m(0),n("p",[e._v("It is also possible to enable CORS for the whole controller:")]),e._v(" "),e._m(1),n("p",[e._v("In this example CORS support is enabled for both retrieve() and remove() handler methods, and you can also see how you can customize the CORS configuration using @CrossOrigin attributes.")]),e._v(" "),n("p",[e._v("You can even use both controller and method level CORS configurations, Spring will then combine both annotation attributes to create a merged CORS configuration.")]),e._v(" "),e._m(2),n("p",[e._v("If you are using Spring Security, make sure to enable CORS at Spring Security level as well to allow it to leverage the configuration defined at Spring MVC level.")]),e._v(" "),e._m(3),n("p",[e._v("Global CORS configuration\nIn addition to fine-grained, annotation-based configuration you’ll probably want to define some global CORS configuration as well. This is similar to using filters but can be declared withing Spring MVC and combined with fine-grained @CrossOrigin configuration. By default all origins and GET, HEAD and POST methods are allowed.")]),e._v(" "),n("p",[e._v("JavaConfig\nEnabling CORS for the whole application is as simple as:")]),e._v(" "),e._m(4),n("p",[e._v("If you are using Spring Boot, it is recommended to just declare a WebMvcConfigurer bean as following:")]),e._v(" "),e._m(5),n("p",[e._v("You can easily change any properties, as well as only apply this CORS configuration to a specific path pattern:")]),e._v(" "),e._m(6),n("p",[e._v("If you are using Spring Security, make sure to enable CORS at Spring Security level as well to allow it to leverage the configuration defined at Spring MVC level.")]),e._v(" "),n("p",[e._v("XML namespace\nIt is also possible to configure CORS with the mvc XML namespace.")]),e._v(" "),n("p",[e._v("This minimal XML configuration enable CORS on /** path pattern with the same default properties than the JavaConfig one:")]),e._v(" "),e._m(7),n("p",[e._v("It is also possible to declare several CORS mappings with customized properties:")]),e._v(" "),e._m(8),n("p",[e._v("If you are using Spring Security, don’t forget to enable CORS at Spring Security level as well:")]),e._v(" "),e._m(9),n("p",[e._v("How does it work?")]),e._v(" "),e._m(10),e._v(" "),n("p",[e._v("AbstractHandlerMapping#setCorsConfiguration() allows to specify a Map with several CorsConfiguration mapped on path patterns like /api/**\nSubclasses can provide their own CorsConfiguration by overriding AbstractHandlerMapping#getCorsConfiguration(Object, HttpServletRequest) method\nHandlers can implement CorsConfigurationSource interface (like ResourceHttpRequestHandler now does) in order to provide a CorsConfiguration for each request.\nFilter based CORS support\nAs an alternative to other methods presented above, Spring Framework also provides a CorsFilter. In that case, instead of using @CrossOrigin or WebMvcConfigurer#addCorsMappings(CorsRegistry), you can for example declare the filter as following in your Spring Boot application:")]),e._v(" "),e._m(11),n("p",[e._v("转载于 "),n("a",{attrs:{href:"https://spring.io/blog/2015/06/08/cors-support-in-spring-framework",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://spring.io/blog/2015/06/08/cors-support-in-spring-framework"),n("OutboundLink")],1)])])},[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v('@RestController\n@RequestMapping("/account")\npublic class AccountController {\n\n\t@CrossOrigin\n\t@GetMapping("/{id}")\n\tpublic Account retrieve(@PathVariable Long id) {\n\t\t// ...\n\t}\n\n\t@DeleteMapping("/{id}")\n\tpublic void remove(@PathVariable Long id) {\n\t\t// ...\n\t}\n}\n')])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v('@CrossOrigin(origins = "http://domain2.com", maxAge = 3600)\n@RestController\n@RequestMapping("/account")\npublic class AccountController {\n\n\t@GetMapping("/{id}")\n\tpublic Account retrieve(@PathVariable Long id) {\n\t\t// ...\n\t}\n\n\t@DeleteMapping("/{id}")\n\tpublic void remove(@PathVariable Long id) {\n\t\t// ...\n\t}\n}\n')])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v('@CrossOrigin(maxAge = 3600)\n@RestController\n@RequestMapping("/account")\npublic class AccountController {\n\n\t@CrossOrigin(origins = "http://domain2.com")\n\t@GetMapping("/{id}")\n\tpublic Account retrieve(@PathVariable Long id) {\n\t\t// ...\n\t}\n\n\t@DeleteMapping("/{id}")\n\tpublic void remove(@PathVariable Long id) {\n\t\t// ...\n\t}\n}\n')])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("@EnableWebSecurity\npublic class WebSecurityConfig extends WebSecurityConfigurerAdapter {\n\n\t@Override\n\tprotected void configure(HttpSecurity http) throws Exception {\n\t\thttp.cors().and()...\n\t}\n}\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v('@Configuration\n@EnableWebMvc\npublic class WebConfig extends WebMvcConfigurerAdapter {\n\n\t@Override\n\tpublic void addCorsMappings(CorsRegistry registry) {\n\t\tregistry.addMapping("/**");\n\t}\n}\n')])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v('@Configuration\npublic class MyConfiguration {\n\n    @Bean\n    public WebMvcConfigurer corsConfigurer() {\n        return new WebMvcConfigurerAdapter() {\n            @Override\n            public void addCorsMappings(CorsRegistry registry) {\n                registry.addMapping("/**");\n            }\n        };\n    }\n}\n')])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v('@Override\npublic void addCorsMappings(CorsRegistry registry) {\n\tregistry.addMapping("/api/**")\n\t\t.allowedOrigins("http://domain2.com")\n\t\t.allowedMethods("PUT", "DELETE")\n\t\t\t.allowedHeaders("header1", "header2", "header3")\n\t\t.exposedHeaders("header1", "header2")\n\t\t.allowCredentials(false).maxAge(3600);\n}\n')])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v('<mvc:cors>\n\t<mvc:mapping path="/**" />\n</mvc:cors>\n')])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v('<mvc:cors>\n\n\t<mvc:mapping path="/api/**"\n\t\tallowed-origins="http://domain1.com, http://domain2.com"\n\t\tallowed-methods="GET, PUT"\n\t\tallowed-headers="header1, header2, header3"\n\t\texposed-headers="header1, header2" allow-credentials="false"\n\t\tmax-age="123" />\n\n\t<mvc:mapping path="/resources/**"\n\t\tallowed-origins="http://domain1.com" />\n\n</mvc:cors>\n')])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("<http>\n\t\x3c!-- Default to Spring MVC's CORS configuration --\x3e\n\t<cors />\n\t...\n</http>\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("blockquote",[t("p",[this._v("CORS requests (including preflight ones with an OPTIONS method) are automatically dispatched to the various HandlerMappings registered. They handle CORS preflight requests and intercept CORS simple and actual requests thanks to a CorsProcessor implementation (DefaultCorsProcessor by default) in order to add the relevant CORS response headers (like Access-Control-Allow-Origin). CorsConfiguration allows you to specify how the CORS requests should be processed: allowed origins, headers, methods, etc. It can be provided in various ways:")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v('@Configuration\npublic class MyConfiguration {\n\n\t@Bean\n\tpublic FilterRegistrationBean corsFilter() {\n\t\tUrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();\n\t\tCorsConfiguration config = new CorsConfiguration();\n\t\tconfig.setAllowCredentials(true);\n\t\tconfig.addAllowedOrigin("http://domain1.com");\n\t\tconfig.addAllowedHeader("*");\n\t\tconfig.addAllowedMethod("*");\n\t\tsource.registerCorsConfiguration("/**", config);\n\t\tFilterRegistrationBean bean = new FilterRegistrationBean(new CorsFilter(source));\n\t\tbean.setOrder(0);\n\t\treturn bean;\n\t}\n}\n')])])])}],!1,null,null,null);r.options.__file="CORS support in Spring framework.md";t.default=r.exports}}]);